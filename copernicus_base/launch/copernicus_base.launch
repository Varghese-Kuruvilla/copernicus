<?xml version="1.0"?>
<launch>

    <group>
        <node name="copernicus_base_node" pkg="copernicus_base" type="copernicus_base_node">
        </node>
    </group>

    <group>
        <arg name="model" default="$(find copernicus_description)/urdf/copernicus.xacro"/>

        <param name="robot_description" command="$(find xacro)/xacro.py --inorder $(arg model)"/>
        
        <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" />
        <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher" />
    </group>

    <group>
        <!-- <node pkg="um7" type="um7_driver" name="imu_driver">
            <param name="port" value="/dev/ttyUSB0"/>
            <param name="mag_updates" value="false"/>
            <param name="tf_ned_to_enu" value="false"/>
            <param name="frame_id" value="imu_link_ned"/>

            <remap from="imu" to="imu/ned"/>
        </node>

        <node pkg="tf" type="static_transform_publisher" name="tf_imu_ned_enu"
        args="0 0 0 1.5708 0 3.1416 imu imu_link_ned 10" output="screen"/>

        <node pkg="imu_transformer" type="imu_transformer_node" name="imu_data_transformer" output="screen">
            <remap from="imu_in" to="imu/ned"/>
            <remap from="imu_out" to="imu/enu"/>
            <param name="target_frame" value="base_link"/>
        </node>

        <node pkg="imu_filter_madgwick" type="imu_filter_node" name="imu_filter">
            <remap from="imu/data_raw" to="imu/enu/data"/>
            <rosparam>
                use_mag: false
                mag_bias_x: 0
                mag_bias_y: 0
                mag_bias_z: 0
                orientation_stddev: 0.001
                gain: 0.01
                zeta: 0.001
                publish_tf: false
            </rosparam>
        </node> -->

        <include file="$(find mavros_tests)/launch/mav.launch"/>

        <include file="$(find copernicus_localization)/launch/localization.launch"/>

    </group>

    <group>
        <node pkg="lms1xx" name="lms1xx" type="LMS1xx_node">
            <param name="host" value="10.0.1.11" />
            <param name="frame_id" value="lidar" />
        </node>
    </group>

    <group>
        <node name="Camera" pkg="usb_cam" type="usb_cam_node">
            <remap from="/Camera/image_raw" to="/image_raw" />

            <param name="video_device" value="/dev/video0" />
            <param name="image_width" value="640" />
            <param name="image_height" value="480" />
            <param name="pixel_format" value="yuyv" />
            <param name="camera_frame_id" value="usb_cam" />
            <param name="io_method" value="mmap"/>
        </node>

    	<node name="Streamer" pkg="web_video_server" type="web_video_server" >
            <param name="address" value="0.0.0.0" />
            <param name="port" value="8080" />
            <param name="quality" value="20" />
            <param name="type" value="ros_compressed" />
        </node>

        <include file="$(find rosbridge_server)/launch/rosbridge_websocket.launch">
        </include>
    </group>

</launch>
